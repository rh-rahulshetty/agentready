name: Link Checker

on:
  push:
    branches:
      - main
      - feature/**
  pull_request:
    branches:
      - main
  workflow_dispatch:

jobs:
  link-check:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v6

      - name: Install lychee
        run: |
          curl -sSL https://github.com/lycheeverse/lychee/releases/download/v0.15.1/lychee-v0.15.1-x86_64-unknown-linux-gnu.tar.gz | tar -xz
          sudo mv lychee /usr/local/bin/
          lychee --version

      - name: Check links in Markdown and HTML files
        run: |
          lychee --config lychee.toml \
            --verbose \
            --no-progress \
            '**/*.md' \
            '**/*.html' \
            --exclude-path '.git' \
            --exclude-path 'node_modules' \
            --exclude-path '.venv'

      - name: Check links in docs directory
        if: always()
        run: |
          lychee --config lychee.toml \
            --verbose \
            --no-progress \
            'docs/**/*.md' \
            'docs/**/*.html' \
            --exclude-path 'docs/_site'
